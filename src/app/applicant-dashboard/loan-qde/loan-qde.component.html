<app-menubar-header></app-menubar-header>
<main>
  <div class="main">

    <div class="lyt-product" *ngIf="isLoanProductPage == true">
      <ul class="product-list">
          <li class="item-product typ-loan" *ngFor="let lt of loanType;" (click)="selectLoanType(lt)">
              <span class="icon icon-home-loan"></span>
              <h3 class="product-title">{{lt.key}}</h3>
          </li>
      </ul>      
    </div>


    <div class="lyt-home" *ngIf="isLoanProductPage == false">
      <div class="tabs">
        <ul class="tabs-head">
          <!-- <li class="tab-link pending" [ngClass]="{'active': (activeTab == 0)}">
            <a href="javascript:void(0);" (click)="tabSwitch(0)">INCOME DETAILS</a>
          </li> -->
          <li class="tab-link" [ngClass]="{'active': (activeTab == 0)}">
            <a href="javascript:void(0);" (click)="tabSwitch(0)">LOAN AMOUNT</a>
          </li>
          <li class="tab-link" [ngClass]="{'active': (activeTab == 1)}">
            <a href="javascript:void(0);" (click)="tabSwitch(1)">PROPERTY</a>
          </li>
          <li class="tab-link" [ngClass]="{'active': (activeTab == 2)}">
            <a href="javascript:void(0);" (click)="tabSwitch(2)">EXISTING LOAN OBLIGATION</a>
          </li>
         
        </ul>
        <div class="tabs-contents" #tabContents>
          <div class="tab-content" [ngClass]="{'active': (activeTab == 0)}">
              <a [routerLink]="['/applicant', qde.application.applicationId, 'co-applicant']" fragment="existingLoan" class="back-btn"></a>
            <div class="lyt-tabs">
              <div class="lhs">

                <div class="swiper-container form-swiper" [swiper]="lhsConfig" #loanAmountSlider1="ngxSwiper">
                  <div class="swiper-wrapper">
                    <div class="swiper-slide">
                      <div class="title-wrap">
                        <h4 class="title">Enter desired loan <span class="cm-line-break"></span>amount & purpose</h4>
                        <!-- <p class="note">Enter the property details for which loan is being sought for</p> -->
                      </div>
                    </div>
                  </div>
                </div>

              </div>

              <div class="rhs">
                <div class="swiper-container form-swiper" [swiper]="rhsConfig" #swiperS="ngxSwiper"
                  (slidePrevTransitionStart)="slidePrevTransitionStart(loanAmountSlider1)"
                  (slideNextTransitionStart)="slideNextTransitionStart(loanAmountSlider1)" #loanAmountSlider2="ngxSwiper">
                  <div class="swiper-wrapper">
                    <div class="swiper-slide">
                    <form class="bs-form" id="personal-form"
                    #loanAmount="ngForm"
                    (ngSubmit)="submitLoanAmount(loanAmount)">
                      <div class="form-wrap">
                        <div class="form-group inr">
                          <input [readonly]="isTBMLoggedIn" type="text" class="form-control" id="amt-require"
                            required
                            [(ngModel)]="qde?.application.loanDetails.loanAmount.amountRequired"
                            #amountRequired = "ngModel"
                            name="amountRequired"
                            fieldFill
                            pattern="^[0-9]*$"
                            (input)="checkNumberLessThan50k($event)">
    
                          <label for="amt-require">Amount required</label>
                          <span class="addon">
                            <span class="icon icon-inr"></span>
                          </span>
                          <span class="in-word"></span>
    
                          <!-- <div class="redalert" *ngIf="amountRequired.touched && amountRequired.invalid">{{errors.loanDetails.loanAmount.amount.minamount}}</div> -->
                          <div class="invalid-feedback">
                            <div *ngIf="amountRequired.touched && isNumberLessThan50k">{{errors.loanDetails.loanAmount.amount.minamount}}</div>
                            <div *ngIf="amountRequired.touched && amountRequired.errors?.required">{{errors.loanDetails.loanAmount.amount.required}}</div>
                            <div *ngIf="amountRequired.errors?.pattern">{{errors.loanDetails.loanAmount.amount.invalid}}</div>
                          </div>
    
                        </div>
                          <!-- <div class="form-group">
                            <span class="control-title">Type of loan</span>
                            <kendo-dropdownlist [readonly]="isTBMLoggedIn" 
                              class="form-control"
                              name="loanType"
                              [data]="loanType" 
                              textField="key"
                              valueField="value"
                              [valuePrimitive]="true"
                              [(ngModel)]="selectedLoanType">
                            </kendo-dropdownlist>
                          </div> -->
                        
                          <div class="form-group">
                            <span class="control-title">Loan purpose</span>
                            <kendo-dropdownlist [readonly]="isTBMLoggedIn" 
                              class="form-control"
                              name="loanPurpose"
                              [data]="loanpurposes" 
                              textField="key"
                              valueField="value"
                              [(ngModel)]="selectedLoanPurpose">
                            </kendo-dropdownlist>
                          </div>
    
                        <div class="form-group typ-range">
                          <span class="control-title">Loan tenure (in years)</span>
                          <input [readonly]="isTBMLoggedIn" type="number" class="form-control" id="no-yrs"
                            required
                            ngModel
                            #loanTenure = "ngModel"
                            min="0"
                            max="30"
                            maxlength="2"
                            oninput="this.value=this.value.slice(0,this.maxLength)"
                            name="loanTenure"
                            [(ngModel)]="qde?.application.tenure"
                            (ngModelChange)="valuechange($event, 0)">
                          <span class="yr-text">Years</span>
    
                          <div *ngIf="tenureYears">
                                <div class="invalid-feedback"><br>{{errors.loanDetails.loanAmount.tenure.invalid}}</div>
                          </div>
                          
                          <ng5-slider class="commSlider" [(value)]="qde?.application.tenure" [options]="options" ></ng5-slider>
    
                          <div *ngIf="(loanTenure.touched || loanTenure.dirty) && loanTenure.invalid" class="invalid-feedback">
                            <!-- <div *ngIf="loanTenure.errors?.required">{{errors.loanDetails.loanAmount.tenure.required}}</div> -->
                            <div *ngIf="loanTenure.errors?.pattern">{{errors.loanDetails.loanAmount.tenure.invalid}}</div>
                          </div>
                        </div>
                      </div>
                      <div class="btn-wrap">
                        <!-- <button type="submit"  class="btn btn-primary">Next</button> -->
                        <button class="btn btn-primary"
                        [ngClass]="{'disabled': loanAmount.invalid || isNumberLessThan50k}"
                        [disabled]="loanAmount.invalid || isNumberLessThan50k">Next</button>
                      </div>
                    </form>
                    </div>
                  </div>
                </div>

              </div>
            </div>

          </div>

          <div class="tab-content" [ngClass]="{'active': (activeTab == 1)}">
            <a href="javascript:void(0);" class="back-btn" (click)="onBackButtonClick(property2)"></a>

            <div class="lyt-tabs">
              <div class="lhs">
                <div class="swiper-container form-swiper" [swiper]="lhsConfig" #property1="ngxSwiper">
                  <div class="swiper-wrapper">
                    <div class="swiper-slide">
                      <div class="title-wrap">
                        <h4 class="title">Have you identified <span class="cm-line-break"></span>the property?</h4>
                        <!-- <p class="note">Enter the property details for which loan is being sought for</p> -->
                      </div>
                    </div>
                    <div class="swiper-slide">
                      <div class="title-wrap">
                        <h4 class="title">Enter the <span class="cm-line-break"></span>property address</h4>
                        <!-- <p class="note">Enter the property details for which loan is being sought for</p> -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="rhs">
                <div class="swiper-container form-swiper" [swiper]="rhsConfig"
                  (slidePrevTransitionStart)="slidePrevTransitionStart(property1)"
                  (slideNextTransitionStart)="slideNextTransitionStart(property1)" #property2="ngxSwiper" #swiperS="ngxSwiper">
                  <div class="swiper-wrapper">
                   
                    <div class="swiper-slide">
                      <form class="bs-form">
                        <div class="form-wrap">
                          <div class="bs-radio">
                            <input [readonly]="isTBMLoggedIn" type="radio" name="yes-property" [value]=true [(ngModel)]="isPropertyIdentified" (click)="changePropertyIdentified(property2, true)" >
                            <label for="yes-property"><span>Yes</span></label>
                          </div>
                          <div class="bs-radio">
                            <input [readonly]="isTBMLoggedIn" type="radio" name="no-property" [value]=false [(ngModel)]="isPropertyIdentified" (click)="changePropertyIdentified(property2, false)">
                            <label for="no-property"><span>No</span></label>
                          </div>
                        </div>
                      </form>
                    </div>
                    <div class="swiper-slide">
                      <form class="bs-form"
                      #propertyType="ngForm"
                      (ngSubmit)="updatePropertyType(propertyType, property2)">
                          <div class="form-wrap">
                              <div class="form-group">
                                <span class="control-title">Property type</span>
                                <kendo-dropdownlist [readonly]="isTBMLoggedIn" 
                                  class="form-control" 
                                  name="propertyTypes1" 
                                  [data]="propertyTypes" 
                                  textField="key" 
                                  valueField="value"
                                  [valuePrimitive]="true" 
                                  [(ngModel)]="selectedPropertyType">
                                </kendo-dropdownlist>
                              </div>
                              <div class="form-group">
                                  <input [readonly]="isTBMLoggedIn"
                                  type="text"
                                  autocomplete="off"
                                  class="form-control"
                                  id="propertyClssArea" 
                                  name="propertyClssArea"
                                  #propertyClss="ngModel"
                                  [(ngModel)]="propertyClssLabel"
                                  pattern="^[a-zA-Z ]+$"
                                  (input)="clssSearchArea($event)"
                                  fieldFill
                                  required >
                                  <label for="propertyClssArea">Property CLSS area</label>
                                  <span class="optional" style="font-size: 1vw">Type to search</span>
                                  <div *ngIf="(propertyClss.touched || propertyClss.dirty) && propertyClss.invalid" class="invalid-feedback">
                                    <!-- <div *ngIf="propertyClss.errors?.required">{{errors.loanDetails.property.propertyClss.required}}</div> -->
                                    <div *ngIf="propertyClss.errors?.pattern">{{errors.loanDetails.property.propertyClss.invalid}}</div>
                                  </div>

                                  <ul class="clss-area-list">
                                    <li *ngFor="let c of allClssAreas;let i=index;" (click)="selectClssArea(c)">
                                      {{c.label}}
                                    </li>
                                  </ul>
                                </div>
                              <div class="form-group">
                                  <input [readonly]="isTBMLoggedIn"
                                  type="text"
                                  class="form-control"
                                  id="pro-add-line2" 
                                  name="propertyAreaInSqFeets"
                                  #propertyArea="ngModel"
                                  [(ngModel)]="propertyAreaValue"
                                  pattern="{{regexPattern.mobileNumber}}"
                                  fieldFill
                                  required/>
                                  <label for="pro-add-line2">Property area in sq. fts.</label>
                                  <div *ngIf="(propertyArea.touched || propertyArea.dirty) && propertyArea.invalid" class="invalid-feedback">
                                    <!-- <div *ngIf="propertyArea.errors?.required">{{errors.loanDetails.property.propertyArea.required}}</div> -->
                                    <div *ngIf="propertyArea.errors?.pattern">{{errors.loanDetails.property.propertyArea.invalid}}</div>
                                  </div>
                              </div>
                          </div>
                          <div class="btn-wrap">
                              <button type="submit" class="btn btn-primary "
                              [ngClass]="{'disabled': !propertyType.valid}"
                              [disabled]="!propertyType.valid">Next</button>
                          </div>
                      </form>
                  </div>
                    <div class="swiper-slide">
                      <form class="bs-form" #submitProperty="ngForm"
                      (ngSubmit)="submitPropertyDetail(submitProperty, property2)">
                        <div class="form-wrap">
                          <div class="form-group">
                            <input [readonly]="isTBMLoggedIn" type="text" class="form-control"
                            id="add-line1"
                            required
                            ngModel
                            #proaddressLineOne="ngModel"
                            [(ngModel)]="addressLineOneValue"
                            name="proaddressLineOne"
                            fieldFill
                            pattern='{{regexPattern.address}}'/>
                      
                            <label for="add-line1">Property address line1</label>

                            <div *ngIf="(proaddressLineOne.touched || proaddressLineOne.dirty) && proaddressLineOne.invalid" class="invalid-feedback">
                              <!-- <div *ngIf="proaddressLineOne.errors?.required">{{errors.loanDetails.property.addressLineOne.required}}</div> -->
                              <div *ngIf="proaddressLineOne.errors?.pattern">{{errors.loanDetails.property.addressLineOne.invalid}}</div>
                            </div>
                          </div>

                          <div class="form-group typ-optional">
                            <input [readonly]="isTBMLoggedIn" type="text" class="form-control" id="add-line2"
                              ngModel
                              #addressLineTwo = "ngModel"
							                fieldFill
                              [(ngModel)]="addressLineTwoValue"
                              name="addressLineTwo"
                              pattern='{{regexPattern.address}}'/>

                            <label for="add-line2">Property address line2</label>
                            <span class="optional">optional</span>
                            <div *ngIf="(addressLineTwo.touched || addressLineTwo.dirty) && addressLineTwo.invalid" class="invalid-feedback">
                              <!-- <div *ngIf="addressLineTwo.errors?.required">{{errors.loanDetails.property.addressLineTwo.required}}</div> -->
                              <div *ngIf="addressLineTwo.errors?.pattern">{{errors.loanDetails.property.addressLineTwo.invalid}}</div>
                            </div>
                          </div>

                          <div class="form-group">
                            <input [readonly]="isTBMLoggedIn" type="text" class="form-control" id="proprty-pin"
                            required
                            ngModel
                            #propertyPincode = "ngModel"
                            [(ngModel)]="propertyPincodeValue"
                            minlength="6"
                            maxlength="6"
                            name="propertyPincode"
							              fieldFill
                            pattern='{{regexPattern.pinCode}}'
                            (change)="onPinCodeChange($event)">

                            <label for="proprty-pin">Property pincode</label>

                            <div class="redalert" *ngIf="RegExp(regexPattern.sameDigit).test(propertyPincode.value)">
                                {{errors.loanDetails.pinCode.wrong}}</div>
                            <div *ngIf="(propertyPincode.touched || propertyPincode.dirty) && propertyPincode.invalid" class="invalid-feedback">
                              <!-- <div *ngIf="propertyPincode.errors?.required">{{errors.loanDetails.property.pinCode.required}}</div> -->
                              <div *ngIf="propertyPincode.errors?.pattern">{{errors.loanDetails.property.pinCode.invalid}}</div>
                            </div>

                          </div>
                          
                          <div class="form-group">
                            <input [readonly]="isTBMLoggedIn" type="text" class="form-control" id="pro-city2"
                              required
                              ngModel
                              #cityOrState = "ngModel"
                              [(ngModel)] = "cityState"
							                fieldFill
                              name="cityOrState"
                              pattern='{{regexPattern.address}}'
                              disabled />
                            <label for="pro-city2">City/State</label>


                            <div *ngIf="(cityOrState.touched || cityOrState.dirty) && cityOrState.invalid" class="invalid-feedback">
                              <!-- <div *ngIf="cityOrState.errors?.required">{{errors.loanDetails.property.cityOrState.required}}</div> -->
                              <div *ngIf="cityOrState.errors?.pattern">{{errors.loanDetails.property.cityOrState.invalid}}</div>
                            </div>
                          </div>
                        </div>
                        <div class="btn-wrap">
                          <!-- <button class="btn btn-primary">Next</button> -->
                          <button class="btn btn-primary"
                          [ngClass]="{'disabled': !submitProperty.valid}"
                          [disabled]="!submitProperty.valid">Next</button>
                        </div>
                      </form>
                    </div>
                    

                  </div>
                </div>

              </div>
            </div>

          </div>



          <div class="tab-content" [ngClass]="{'active': (activeTab == 2)}">
            <a href="javascript:void(0);" class="back-btn" (click)="onBackButtonClick(existingLoan2)"></a>
            <div class="lyt-tabs">
                <div class="lhs">
                    <div class="swiper-container form-swiper " [swiper]="lhsConfig" #existingLoan1="ngxSwiper">
                      <div class="swiper-wrapper">
                        <div class="swiper-slide">
                          <div class="title-wrap">
                            <h4 class="title">Select an Applicant</h4>
                            <p class="note"></p>
                          </div>
                        </div>
                        <div class="swiper-slide">
                          <div class="title-wrap">
                              <h4 class="title">Enter total number <span class="cm-line-break"></span>of live loans</h4>
                              <p class="note">For applicant {{selectedApplicantName}}</p>
                          </div>
                        </div>
                        <div class="swiper-slide" *ngIf="selectedLoanPurpose && ['16', '17'].includes(selectedLoanPurpose.value)">
                          <div class="title-wrap">
                              <h4 class="title">Select existing<span class="cm-line-break"></span>loan provider</h4>
                              <p class="note">For Applicant {{selectedApplicantName}}</p>
                          </div>
                        </div>
                        <div class="swiper-slide">
                          <div class="title-wrap">
                            <h4 class="title">Enter total existing <span class="cm-line-break"></span>monthly EMI</h4>
                            <p class="note">For Applicant {{selectedApplicantName}}</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
             
              <div class="rhs">
                <div class="swiper-container form-swiper" [swiper]="rhsConfig"
                  (slidePrevTransitionStart)="slidePrevTransitionStart(existingLoan1)"
                  (slideNextTransitionStart)="slideNextTransitionStart(existingLoan1)" #existingLoan2="ngxSwiper" #swiperS="ngxSwiper">
                  <div class="swiper-wrapper">

                    <!-- Select an applicant for Existing Loan -->
                    <div class="swiper-slide">
                      <form class="bs-form" (ngSubmit)="submitAnApplicantForExistingLoan(selectApplicantForExistingLoanForm, existingLoan2)" #selectApplicantForExistingLoanForm="ngForm">
                        <div class="form-wrap">
                          <div class="form-group">
                            <kendo-dropdownlist [readonly]="isTBMLoggedIn" 
                                                class="form-control"
                                                name="selectApplicant"
                                                [data]="allApplicantsItem" 
                                                textField="key" 
                                                valueField="value" 
                                                [(ngModel)]="selectedApplicant">
                            </kendo-dropdownlist>
                          </div>
                        </div>
                        <div class="btn-wrap">
                          <button type="submit" class="btn btn-primary">Next</button>
                        </div>
                      </form>
                    </div>

                      <div class="swiper-slide">
                          <form class="bs-form" #liveLoansForm="ngForm" 
                          (ngSubmit)="submitLiveLoans(liveLoansForm, existingLoan2)">
                            <div class="form-wrap">
                              <div class="form-group">
                                <div class="form-group typ-range">
                                    <span class="control-title">Live Loans</span>
                                    <input type="number"
                                            name="liveLoansNumber"
                                            class="form-control"
                                            [ngModel]="liveLoan"
                                            (ngModelChange)="valuechange($event, 1)" />
                                    <ng5-slider class="commSlider"
                                                [(value)]="liveLoan"
                                                name="liveLoans"
                                                [options]="liveLoanOption">
                                    </ng5-slider>
                                </div>
                              </div>
                            </div>
                            
                            <div  *ngIf="liveLoan == 0" class="btn-wrap" >
                              <button  type="submit" class="btn btn-primary">Save</button>
                          </div>
                          <div  *ngIf="liveLoan != 0" class="btn-wrap" >
                            <button  type="submit" class="btn btn-primary">Next</button>
                          </div>
                          </form>
                        </div>

                    <div class="swiper-slide" *ngIf="selectedLoanPurpose && ['16', '17'].includes(selectedLoanPurpose.value)">
                      <form class="bs-form" #loanProvider="ngForm"
                      (ngSubmit)="submitExistingLoanProvider(loanProvider, existingLoan2)">
                        <div class="form-wrap">
                          <div class="form-group">
                            <span class="control-title">Loan provider</span>
                            <kendo-dropdownlist [readonly]="isTBMLoggedIn" 
                                                class="form-control" 
                                                name="loanProvider" 
                                                [data]="loanProviderList"
                                                textField="key"
                                                valueField="value"
                                                [(ngModel)]="selectedLoanProvider">
                            </kendo-dropdownlist>
                          </div>
                        </div>
                
                        <div class="btn-wrap">
                          <button type="submit" class="btn btn-primary" 
                          [ngClass]="{'disabled': !loanProvider.valid}"
                          [disabled]="!loanProvider.valid">Next</button>
                        </div>
                      </form>
                    </div>


                    <div class="swiper-slide">
                      <form class="bs-form"
                      #monthlyEmiForm="ngForm"
                      (ngSubmit)="submitMonthlyEmi(monthlyEmiForm, existingLoan2)">
                        <div class="form-wrap">
                          <div class="form-group inr typ-optional">
                            <input [readonly]="isTBMLoggedIn" type="text" class="form-control" id="monthly-emi"
                              ngModel
                              #monthlyEmi = "ngModel"
                              [(ngModel)]="monthlyEmiValue"
                              fieldFill
                              name="monthlyEmi" pattern="^[0-9]*$"/>

                            <label for="monthly-emi">Monthly EMI</label>
                            <span class="optional">optional</span>
                            <div class="redalert" *ngIf="monthlyEmi.touched && monthlyEmi.valid && !isValidNumber(monthlyEmi.value)">{{errors.loanDetails.existingLoans.monthlyEmi.invalid}}</div>
                            <div *ngIf="(monthlyEmi.touched || monthlyEmi.dirty) && monthlyEmi.invalid" class="invalid-feedback">
                              <!-- <div *ngIf="monthlyEmi.errors?.required">{{errors.loanDetails.existingLoans.monthlyEmi.required}}</div> -->
                              <!-- <div *ngIf="monthlyEmi.errors?.pattern">{{errors.loanDetails.existingLoans.monthlyEmi.invalid}}</div> -->
                            </div>

                            <span class="addon">
                              <span class="icon icon-inr"></span>
                            </span>
                            <span class="in-word"></span>
                          </div>
                        </div>
                        <div class="btn-wrap">
                          <button class="btn btn-primary"
                          [ngClass]="{'disabled': monthlyEmi.invalid || !isValidNumber(monthlyEmi.value)}"
                          [disabled]="monthlyEmi.invalid || !isValidNumber(monthlyEmi.value)">Save</button>
                        </div>
                      </form>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>



        </div>
      </div>
    </div>
  </div>
  <!-- <span class="cm-autoSave"><span class="cm-bold">Autosaved</span> <span>at 09:26 AM</span></span> -->
  <div class="overlay" [ngClass]="{'active': isLoanRouteModal}"></div>
  <div class="bs-modal" id="biomatric-modal" [ngClass]="{'active': isLoanRouteModal}">
      <a class="modal-close" (click)="onCrossModal()"><span class="icon icon-close"></span></a>
      <div class="modal-body">
          <h1 class="center">Loan Details has been successfully saved!</h1>
          <p>Click Proceed to continue</p>
              <div class="btn-wrap">
                  <button class="btn btn-border"  [routerLink]="['/references', qde.application.applicationId]">Proceed</button>
              </div>
      </div>
  </div>
  <div class="overlay" [ngClass]="{'active': isClssEligibleModal}"></div>
  <div class="bs-modal" id="biomatric-modal" [ngClass]="{'active': isClssEligibleModal}">
      <!-- <a class="modal-close" href="javascript:void(0);" (click)="onBackOTP()"><span class="icon icon-close"></span></a> -->
      <div class="modal-body">
          <h1 class="center">Application is eligible for CLSS</h1>
          <p>Click Proceed to continue</p>
              <div class="btn-wrap">
                  <button class="btn btn-border" (click)="proceedToExistingLoanEligible()">Proceed</button>
              </div>
      </div>
  </div>
  <div class="overlay" [ngClass]="{'active': isClssNotEligibleModal}"></div>
  <div class="bs-modal" id="biomatric-modal" [ngClass]="{'active': isClssNotEligibleModal}">
      <!-- <a class="modal-close" href="javascript:void(0);" (click)="onBackOTP()"><span class="icon icon-close"></span></a> -->
      <div class="modal-body">
          <h1 class="center">Application is not eligible for CLSS</h1>
          <p>Click Proceed to continue</p>
              <div class="btn-wrap">
                  <button class="btn btn-border" (click)="proceedToExistingLoanNotEligible()">Proceed</button>
              </div>
      </div>
  </div>
</main>

<div class="overlay"></div>